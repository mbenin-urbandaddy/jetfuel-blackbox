#!/usr/bin/env node

var MODULES = 'node_modules',
    FORCE = '--force';

var fs = require('fs'),
    path = require('path'),
    util = require('util'),
    puts = util.puts,
    args = process.argv.splice(2),
    pwd = process.cwd(),
    cwd = pwd.split('/'),
    projectName = cwd.pop(),
    dirName = cwd.pop(),
    target,
    modules;

if(dirName == MODULES) {
    try {
        if(fs.existsSync(target = cwd.concat(projectName).join('/')) && args[0] != FORCE) {
            puts('Target directory exists: ' + target);
            process.exit(1);
        } else {
            fs.renameSync(pwd, target);
            puts('Moved project "' + projectName + '" to target: ' + target);
            process.cwd(target);
            puts('Changed working directory: ' + target);
            if(!fs.readdirSync(modules = path.resolve(target + '/../' + MODULES)).length) {
                fs.rmdirSync(modules);
                puts('Removed empty modules directory: ' + modules);
            }
        }
    } catch(e) {
        util.error(e);
        process.exit(1);
    }
}